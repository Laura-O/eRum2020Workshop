<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Bring your R Application Safely to Production.</title>
    <meta charset="utf-8" />
    <meta name="author" content="Francesca Vitalini" />
    <meta name="date" content="2020-04-16" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Bring your R Application Safely to Production.
## Collaborate, Deploy, Automate.
### Francesca Vitalini
### 2020-04-16

---




layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;Copyright (c) 2020&lt;/span&gt;&lt;/div&gt; 

---

![devCycle](./img/MiraiApr19_full.jpg)

&lt;br&gt;

### Bring ideas to life.
### Smart. Agile. Personal.

&lt;img src="./img/mirai-solutions-logo-flyer.png" width="50%" style="position:absolute;bottom:100px;right:50px;" /&gt;

---

## Workshop Overview

- Fork the starting point package and shiny app
- Version control
- Automating controls on TravisCI
- **Break**
- Gitflow
- Agile development
- Pull requests and branches control
- Deploymnet on shinyapps.io
- **Break**
- GitHub Actions
- Automatic Deployment
- Release
- Conclusions

---

class: inverse center middle
## At the beginning there was a shiny app

---

## Shiny app

Describe Starting point Productive object → shiny app 
Is an existing simple production ready package available on github they can fork.

---

## How to Fork

Instructions to make a fork on GitHub

---

## Project structure

Show package includes functions and unit test, documentation, and a shiny app.
Motivation: packaged shiny app to use RMD check; explain “production ready” → summary of Vanlog’s workshop main points

---

### Package

*"In R, the fundamental unit of shareable code is the package. A package bundles together code, data, documentation, and tests, and is easy to share with others."*, [Introduction to R packages by Hadley Wickham](http://r-pkgs.had.co.nz/intro.html)

&lt;img src="./img/package_structure.png" width="80%" style="position:absolute;bottom:100px;right:50px;" /&gt;

---

## Production Ready

Running RMD Check discover documentation is incomplete (they need to fix it).

---

# What does Production mean?

The product-building process is an automated, streamlined pipeline, optimized for speed of delivery to the end-user.

By automating building and testing processes, the pipeline to production ensures:

  - Security  
  - Quality  
  - Stability  
  
Production is not a fixed object, but a continuous improvement cycle.

&lt;img src="./img/devCycle.001.png" width="35%" style="position:absolute;bottom:60px;right:50px;" /&gt;

---

## Best Practices

Modularize your code. (functions and package structure in R)

Have your building blocks general and flexible.

Make your code robust with automated testing.

Trace your work with a version control system

---

## Version Control

Version control → code versioned and not just local. Starting point for collaborative work

&lt;img src="./img/git.png" width="80%" style="position:absolute;top:200px;left:50px;" /&gt;

`R CMD check`

&lt;img src="./img/R-CMD-checks.png" width="60%" style="position:absolute;bottom:50px;right:50px;" /&gt;

---

## Automating Controls

Benefits of automating controls → travis → make an example that looks innocuous but fails. One does not want to rely on people manually running checks before committing.

Continuous Integration (CI) is the practice of automatically merging current development work to a shared mainline, also multiple time a day. 

---

## Travis CI

Travis CI is an open-source continuous integration service that can be used to build and test software projects hosted on GitHub.

`usethis::use_travis(ext = "com")` creates a Travis CI configuration file (`.travis.yml`)


```yaml
language: r
cache: packages
```

To enable Travis CI go to [Travis-ci.com](https://travis-ci.com/) and Sign up with GitHub.

On Travis CI the user needs to select the repositories on which to activate the continuous integration.

Then GitHub notifies Travis CI of the occurrence of new commits / pull requests, triggering actions on Travis CI as specified in .travis.yml

A badge indicating the CI status can be integrated in the `README.md`.

---

class: inverse center middle
# Break

---

## Gitflow

Collaboration, gitflow. → branches (develop / feature), control development process, work in parallel. 

.pull-left[
[Gitflow](https://nvie.com/posts/a-successful-git-branching-model/) is a standard setup that allows a collaborative development, while assuring the safety of the released product.

According to the Gitflow approach, the central repo holds two main branches with an infinite lifetime:
master: branch where source code of HEAD always reflects a production-ready state.
develop: branch where source code of HEAD always reflects a state with the latest delivered developments for the next release. 
Each feature branch provides an additional incremental value to the product, potentially ready for deployment. ]

.pull-right[
&lt;img src="./img/gitflow.png" width="40%" style="position:absolute;bottom:50px;right:50px;" /&gt;
https://nvie.com/posts/a-successful-git-branching-model/
]

---

## Collaboration

Gitflow is an Agile framework by nature.

&lt;img src="./img/project-board.png" width="80%" style="position:absolute;bottom:100px;right:50px;" /&gt;

---

## New Issues

screenshot on how to make one.
show how to create a branch.
Live: fix issue on the branch --&gt; make a pull request to merge this into the main branch

---

## Pull Requests and branches control

Pull requests control branches. Necessity of controls on pull requests to ensure robustness and stability of the code.

Set restrictions on branches: require review and status check (travis-ci) before merging to master or develop. 
Screenshot on where to set branches controls?

Screenshots to see the checks passibg before merging?

---

## Deployment shinyapps.io

Setup shinyapp.io → is our productive environment
Manual deployment → check all works

---

## Agile Development

#### Why DevOps?

**Goals**
Achieve faster time to production
Enable more frequent deployments
Lower failure rate of new releases
Shorten lead time between fixes
Enhance collaboration between groups


**Challenges**
Mindset and Culture
Security
Responsibility


**Benefits**
Development via small work items increases the speed of development and improves its quality.
Slow, repetitive and human made actions are error-prone. Automation in testing and deployment increases the stability of the production process.
Version controlled development ensures traceability and repeatability of the development.
Collaboration and an agile approach are keys to a functional production pipeline.
Building, testing and deploying discrete development components improve confidence in the final product.


Note:
Infrastructure can also follow a continuous delivery philosophy (Infrastructure as Code).

**DevOps is a culture. Tools can enable it.**


&lt;img src="./img/devops.001.png" width="80%" style="position:absolute;bottom:100px;right:50px;" /&gt;

---

class: inverse center middle
# Break

---

## GitHub Actions

How to set up CI in GitHub Actions

---

## Automatic Deployment

Automatic deployment / continuous deployment via github actions → streamline deployment process (DevOps). Exercise: Automatic deployment / continuous deployment via travis → streamline deployment process (DevOps) → link tech guides

SCRENSHOT OF THE CHECKS PASSING?

---

## Tockens

---

## Secrets

---

## Release

Release concept → you plan a release with a specific chunk of development. Release branch. Tags. Versions.

According to the Gitflow approach, no work should be pushed directly to `master`, which is updated as part of a release with a pull request from a stable `develop` branch or a `release` branch.

Create a release branch (e.g. `release/v2.0.0`) from `develop`.

Consolidate the changelog (`NEWS.md` in R, see e.g. [recommendations](http://r-pkgs.had.co.nz/release.html#important-files) and [style guide](https://style.tidyverse.org/news.html#news-release)).
Example
```
1.0.0 release preps
* Closes #XYZ Updated report.
```

Update package version (NEWS.md and DESCRIPTION files in R).

Create and merge a new pull request release/v2.0.0 →  master,  where the `closes XXX` are in the pull request comment.

Create a new release tag on master (on [GitHub Code &gt; releases &gt; Draft new release](https://github.com/miraisolutions/SmaRP/releases/new)).
  - Tag version: v1.0.1
  - Release title: packagename 1.0.1
  - Body: Paste as comment the list of changes in `NEWS.md`
  - Click on "Publish release"

Create a new pull request and merge release/v2.0.0  →  develop

Prepare for next version on develop (by changing the version NEWS.md and DESCRIPTION files).

SCREENSHOT OF RELEASE TAG?

---

## Conclusions

Final product and release

---

class: inverse center middle
# What's Next

---

## Next Steps

Next Steps, technical info → close workshop

---

class: inverse center middle
# Thank you!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "%current%/%total%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  /* Replace <script> tags in slides area to make them executable
   *
   * Runs after post-processing of markdown source into slides and replaces only
   * <script>s on the last slide of continued slides using the .has-continuation
   * class added by xaringan. Finally, any <script>s in the slides area that
   * aren't executed are commented out.
   */
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container:not(.has-continuation) script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
  var scriptsNotExecuted = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container.has-continuation script'
  );
  if (!scriptsNotExecuted.length) return;
  for (var i = 0; i < scriptsNotExecuted.length; i++) {
    var comment = document.createComment(scriptsNotExecuted[i].outerHTML)
    scriptsNotExecuted[i].parentElement.replaceChild(comment, scriptsNotExecuted[i])
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
